--crear una tabla a partir de una consulta

select cli_cod, cli_nom into alumno from clientes;
select * from alumno;
--cambiar/ renombrar nombres a las columnas
sp_rename 'alumno.cli_cod','alu_cod'
sp_rename 'alumno.cli_nom','alu_nom'
--cambiar contenido 
update alumno set alu_cod='A'+right(alu_cod,4);
--funcion que genere codigo
GO
create or alter function GENCOD()
RETURNS CHAR(5)
AS
BEGIN
DECLARE @COD CHAR(5),@CUENTA INT
SELECT @CUENTA=isnull(RIGHT(MAX(ALU_COD),4),0)+1 FROM ALUMNO
--is de que si esta vacio no va a regresar el maximo, si no un nulo, y para que no de error entonces se pone
--el 0 para que sea el numero que de cuando este este vacio
set @COD='A'+RIGHT('000'+LTRIM(@CUENTA),4)
--TOMA EN CUENTA LO QUE ESTA A LA DERECHA
RETURN @COD
END
--CADA QUE SE INSERTA UN NUEVO DATO, LA FUNCION CREARA UN NUEVO CODIGO QUE SERA EL SIGUIENTE DEL ANTERIOR
PRINT DBO.GENCOD()
--IMPRIME LA FUNCION QUE ACABAMOS DE CREAR
INSERT INTO ALUMNO VALUES(DBO.GENCOD(),'PALOMINO JUAN')
SELECT * FROM ALUMNO
--INSERTA EL DATO 'PALOMINO JUAN' EN LA TABLA EN LA COLUMNA 2(OSEA LA COLUMNA ALU_COD) Y SE EJECUTA EN LA
--COLUMNA 1(ALU_COD) LA FUNCION HECHA PARA QUE GENERE UN CODIGO PARA EL NUEVO NOMBRE

--ADICIONAR CUATRO CAMPOS ENTEROS DONDE ALMACENE SUS 4 PRACTICAS
ALTER TABLE ALUMNO ADD PC1 INT
ALTER TABLE ALUMNO ADD PC2 INT
ALTER TABLE ALUMNO ADD PC3 INT
ALTER TABLE ALUMNO ADD PC4 INT
--CREA NUEVAS COLUMNAS PC
SELECT * FROM ALUMNO
UPDATE ALUMNO SET PC1=ABS(CHECKSUM(NEWID()))%21
--GENERA NUMEROS ALEATORIOS PARA LA COLUMNA DEFINIDA
UPDATE ALUMNO SET PC2=ABS(CHECKSUM(NEWID()))%21
UPDATE ALUMNO SET PC3=ABS(CHECKSUM(NEWID()))%21
UPDATE ALUMNO SET PC4=ABS(CHECKSUM(NEWID()))%21
--PARA EL RESTO

--UNA FUNCION QUE OBTENGA EL PROMEDIO DE PRACTICAS ELIMINANDO LA NOTA MAS BAJA
GO
create or alter function PROME(@N1 INT,@N2 INT, @N3 INT, @N4 INT)
RETURNS DECIMAL(3,1)
AS
BEGIN
DECLARE @MIN INT, @PRO DECIMAL(3,1)
SET @MIN=@N1;
IF @N2<@MIN
	SET @MIN=@N2
IF @N3<@MIN
	SET @MIN=@N3
IF @N4<@MIN
	SET @MIN=@N4
SET @PRO=(@N1+@N2+@N3+@N4 -@MIN)/3
RETURN @PRO
END;
SELECT ALU_NOM,PC1,PC2,PC3,PC4,DBO.PROME(PC1,PC2,PC3,PC4) PROMEDIO
FROM ALUMNO

PRINT cast((3+8)/2.0 AS DECIMAL(4,2))
PRINT(3+8)/2.0